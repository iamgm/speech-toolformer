# Magic Paste ‚ú®

> **–ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è "–±–µ—Å—à–æ–≤–Ω–æ–π" —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–∫—Å—Ç–æ–º, —Ä–∞—Å—à–∏—Ä—è—é—â–∏–π –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –≤ –ª—é–±–æ–π —Å—Ä–µ–¥–µ Windows.**

![Demo](demo/gif_demo_2.gif)
*(–í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ GIF —Å –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–µ–π —Ä–∞–±–æ—Ç—ã: –í—ã–¥–µ–ª–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ -> F8 -> –ì–æ–ª–æ—Å–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ -> –†–µ–∑—É–ª—å—Ç–∞—Ç)*

---

## üöÄ –û –ø—Ä–æ–µ–∫—Ç–µ

**Magic Paste** —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ (Copy-Paste-Switch) –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å LLM. –≠—Ç–æ –æ–≤–µ—Ä–ª–µ–π–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—Å—Ç, –ø–∏—Å–∞—Ç—å –∫–æ–¥ –∏–ª–∏ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç –ø—Ä—è–º–æ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º –æ–∫–Ω–µ (IDE, –ë—Ä–∞—É–∑–µ—Ä, –ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä) —Å –ø–æ–º–æ—â—å—é –≥–æ–ª–æ—Å–æ–≤—ã—Ö –∫–æ–º–∞–Ω–¥.

### –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- **Zero-Focus UI:** –ü–ª–∞–≤–∞—é—â–µ–µ –æ–∫–Ω–æ –Ω–µ –æ—Ç–±–∏—Ä–∞–µ—Ç —Ñ–æ–∫—É—Å –≤–≤–æ–¥–∞ —É –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
- **–ì–ª—É–±–æ–∫–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –û–°:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ WinAPI (`ctypes`) –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—É—Ñ–µ—Ä–æ–º –æ–±–º–µ–Ω–∞ –∏ —ç–º—É–ª—è—Ü–∏–∏ –≤–≤–æ–¥–∞.
- **Local-First:** –ü–æ–ª–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å. LLM (Gemma) –∏ STT (Whisper) —Ä–∞–±–æ—Ç–∞—é—Ç –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ GPU.
- **–ú—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω–æ—Å—Ç—å:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ–ª–æ—Å–æ–≤–æ–≥–æ –≤–≤–æ–¥–∞ –∏ –æ–∑–≤—É—á–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ (TTS).

---

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –≥–∏–±—Ä–∏–¥–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ: Python (UI/Logic) + C++ (High-Performance Inference).

```mermaid
graph TD
    User((User)) -->|Hotkey F8| UI[Overlay UI / PySide6]
    
    subgraph "System Layer"
        UI -->|Capture Context| Clip[Clipboard Manager]
        Clip -- WinAPI --> ActiveApp[Active Window]
    end

    subgraph "Application Core"
        UI -->|Audio Stream| Rec[Audio Recorder]
        Rec -->|WAV Buffer| Unified[Unified AI Service]
        Unified -->|Routing| Logic[State Machine]
    end

    subgraph "AI Inference Layer (Configurable)"
        direction TB
        
        Unified -->|STT Strategy| STT_Select{Provider?}
        STT_Select -- "whisper" --> Whisper[Faster-Whisper / CUDA]
        STT_Select -.->|experimental| Native[Gemma Native / GPU]
        
        Unified -- HTTP/JSON --> Server[Llama.cpp Server / GPU]
        Server -.->|Gemma 3n| Unified
        
        Logic -->|TTS Strategy| TTS_Select{Provider?}
        TTS_Select -- "silero" --> Silero[Silero V5 / CPU]
        TTS_Select -- "edge" --> Edge[EdgeTTS / Cloud]
    end

    Logic -->|Tool Action| Clip
    Clip -->|Paste Result| ActiveApp
    Logic -->|Chat Response| UI
    Logic -->|Voice Feedback| TTS_Select
```

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ—à–µ–Ω–∏—è

1. **Unified AI Service:** –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–π—Ä–æ—Å–µ—Ç—è–º–∏. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω **Strategy** –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, Whisper vs Native Gemma Audio).
2. **Llama Server Orchestration:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `llama-server.exe` —á–µ—Ä–µ–∑ `subprocess` —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º —á–µ—Ä–µ–∑ **Windows Job Objects**. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–æ–º–±–∏-–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ –∏ —É—Ç–µ—á–µ–∫ VRAM –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
3. **Optimized Inference:**
    - **LLM:** Gemma-3n (4-bit quantized) –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–∞ GPU —á–µ—Ä–µ–∑ `llama.cpp`.
    - **STT:** Faster-Whisper (int8) –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω –¥–ª—è CPU, —á—Ç–æ–±—ã –æ—Å–≤–æ–±–æ–¥–∏—Ç—å VRAM –¥–ª—è LLM.
    - **Prefix Caching:** –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è –æ—Ç–∫–ª–∏–∫–∞.

---

## üõ† –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ó–∞–ø—É—Å–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **OS:** Windows 10/11 (x64)
- **GPU:** NVIDIA GeForce RTX 3050 (4GB VRAM) –∏–ª–∏ –ª—É—á—à–µ.
- **Soft:** Python 3.10+, CUDA Toolkit (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 12.x).

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
git clone https://github.com/iamgm/magic-paste.git
cd magic-paste

# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv .venv
.venv\Scripts\activate

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∏–±–ª–∏–æ—Ç–µ–∫
pip install -r requirements.txt
```

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –±–∏–Ω–∞—Ä–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ –∏ –º–æ–¥–µ–ª–µ–π

–ü—Ä–æ–µ–∫—Ç –Ω–µ —Ö—Ä–∞–Ω–∏—Ç –±–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –ò—Ö –Ω—É–∂–Ω–æ —Å–∫–∞—á–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ:

1. **Llama Server:**
    - –°–∫–∞—á–∞–π—Ç–µ `llama-server.exe` (–≤–µ—Ä—Å–∏—è `b46xx` –∏–ª–∏ –Ω–æ–≤–µ–µ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π CUDA) –∏–∑ [—Ä–µ–ª–∏–∑–æ–≤ llama.cpp](https://github.com/ggerganov/llama.cpp/releases).
    - –ü–æ–º–µ—Å—Ç–∏—Ç–µ —Ñ–∞–π–ª –≤ –ø–∞–ø–∫—É: `src/bin/llama-server.exe`.

2. **–ú–æ–¥–µ–ª–∏ (Hugging Face):**
    - –°–æ–∑–¥–∞–π—Ç–µ –ø–∞–ø–∫—É `models/`.
    - –°–∫–∞—á–∞–π—Ç–µ [Gemma-3n-4B-It-GGUF](https://huggingface.co/Iamgm/magic-paste-gemma-3n-4b).
    - *(–≠–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è –æ–ø—Ü–∏—è)* –î–ª—è Gemma ASR —Å–∫–∞—á–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç–æ—Ä `mmproj-model-f16.gguf`.

### 3. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–§–∞–π–ª `config.yaml` —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é. –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å:

- `hotkey`: –ö–ª–∞–≤–∏—à–∞ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ (default: F8).
- `paste_delay`: –ó–∞–¥–µ—Ä–∂–∫–∞ –ø–µ—Ä–µ–¥ –≤—Å—Ç–∞–≤–∫–æ–π (—É–≤–µ–ª–∏—á—å—Ç–µ, –µ—Å–ª–∏ –ü–ö –º–µ–¥–ª–µ–Ω–Ω—ã–π).
- `tts.provider`: –í—ã–±–æ—Ä –≥–æ–ª–æ—Å–∞ (`silero` –¥–ª—è –æ—Ñ—Ñ–ª–∞–π–Ω–∞, `edge` –¥–ª—è –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –æ–Ω–ª–∞–π–Ω–∞).

### 4. –ó–∞–ø—É—Å–∫

```bash
python src/main.py
```

---

## üéÆ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. –í—ã–¥–µ–ª–∏—Ç–µ –ª—é–±–æ–π —Ç–µ–∫—Å—Ç –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ –∫–æ–¥–∞, –±—Ä–∞—É–∑–µ—Ä–µ –∏–ª–∏ Word.
2. –ù–∞–∂–º–∏—Ç–µ **F8**. –ü–æ—è–≤–∏—Ç—Å—è –æ–≤–µ—Ä–ª–µ–π.
3. –ü—Ä–æ–∏–∑–Ω–µ—Å–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É:
    - *–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:* "–ü–µ—Ä–µ–≤–µ–¥–∏ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π", "–ù–∞–π–¥–∏ –æ—à–∏–±–∫—É –≤ –∫–æ–¥–µ", "–°–¥–µ–ª–∞–π —Ç–µ–∫—Å—Ç –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–º".
    - *–ß–∞—Ç:* "–ö–∞–∫ –¥–µ–ª–∞?", "–†–∞—Å—Å–∫–∞–∂–∏ —Å–∫–∞–∑–∫—É".
4. –û—Ç–ø—É—Å—Ç–∏—Ç–µ **F8** (–∏–ª–∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å —Ç–∏—à–∏–Ω—ã, –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏).
5. **–ú–∞–≥–∏—è:** –†–µ–∑—É–ª—å—Ç–∞—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–º–µ–Ω–∏—Ç –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –∏–ª–∏ –±—É–¥–µ—Ç –æ–∑–≤—É—á–µ–Ω –≥–æ–ª–æ—Å–æ–º.

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π MIT. –ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [LICENSE](LICENSE).

---

**–ê–≤—Ç–æ—Ä:** Iamgm
**–ö—É—Ä—Å:** Deep Learning (Speech, –æ—Å–µ–Ω—å 2025)
